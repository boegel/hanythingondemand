#!/usr/bin/env python

import sys

try:
    from mpi4py import MPI
except ImportError, e:
    sys.stderr.write('Error: Could not import mpi4py. Is the an environment module providing MPI support loaded?')
    sys.stderr.write('Underlying error is: "%s"' % e)
    sys.exit(1)

from hod.subcommands import pbs, query, helptemplate, genconfig

def usage():
    print 'hod: hanythingondemand - Run services within a torque cluster ' 
    print 'usage: hod [--version] [--help] <command> <command-args>'
    print 'The most commonly used commands are:'
    print '    create           Creates a cluster.'
    print '    list             List running clusters.'
    print '    help-template    Print template names and values for diagnostic purposes.'
    print '    genconfig        Generate configuration files for a config.'
    return 1

cmds = {'create': pbs.CreatePbsApplication,
        'list': query.QueryApplication,
        'help-template': helptemplate.HelpTemplateApplication,
        'genconfig': genconfig.GenConfigApplication,
       }

def main(args):
    if len(args) == 1:
        sys.exit(usage())
    if args[1] not in cmds:
        sys.exit(usage())

    cmd = cmds[args[1]]()
    cmd.run(args[1:])

if __name__ == '__main__':
    sys.exit(main(sys.argv))
